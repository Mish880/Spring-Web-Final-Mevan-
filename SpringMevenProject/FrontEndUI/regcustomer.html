<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Auto Motive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="Mishel Perera" name="author">
    <link rel="icon" href="assets/images/DashIcone.png">
    <link rel="stylesheet" href="assets/BootStrap/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="assets/images/DashIcone.png" alt="" width="30" height="24" class="d-inline-block align-text-top">
            AUTOMOTIVE
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html" id="homeBtn">HOME</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="guestcustomer.html" id="guestCustomerBtn">GUESTCUSTOMER</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="regcustomer.html" id="regCustomerBtn">REGCUSTOMER</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="vehicle.html" id="VehicleBtn">VEHICLE</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="driver.html" id="DriverBtn">DRIVER</a>
                </li>
            </ul>
            <form class="d-flex">
                <button class="btn btn-sm btn-outline-info" type="button">Logout</button>
            </form>
        </div>
    </div>
</nav>

<section class="container-fluid mt-3">
    <section class="row mt-3 justify-content-around">
        <div class="col-12 col-md-4">
            <h1 class="text-secondary"> Register Customer Form</h1>
            <div class="mb-3">
                <form class="d-flex">
                    <button class="btn btn-dark"  type="button"  id="btnRegCustomerSearch">Search Reg Customer</button>
                    <input class="form-control" id="txtSearchRegCusID" placeholder="Register Customer ID" type="text">

                </form>
            </div>
            <div class="mb-3">
                <div class="card" style="width: 30rem;">
                    <img src="assets/images/CusImg.png" class="card-img-top" alt="Error loading image">
                    <div class="card-body">
                        <h5 class="card-title">Add Register Customer Details</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        <a href="#" class="btn btn-primary">Go somewhere</a>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-12 col-md-5">
            <form id="RegCustomerFrom">
            <button class="btn btn-primary"  type="button" id="btnSaveCustomer">Add New Customer Details</button>
            <button class="btn btn-success"  type="button" id="btnGetAllCustomer">Get All Customer</button>
            <button class="btn btn-warning"  type="button"  id="btnRegCustomerUpdate">Update Customer</button>
            <div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegCusID">Customer ID</label>
                    <input class="form-control" id="txtRegCusID" name="regid" placeholder="Customer ID" type="text">
                    <p><small class="text-danger pl-1" id="lblcusid"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegCusName">Customer Name</label>
                    <input class="form-control" id="txtRegCusName" name="regname" placeholder="Customer Name" type="text">
                    <p><small class="text-danger pl-1" id="lblcusname"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegAddress">Customer Address</label>
                    <input class="form-control" id="txtRegAddress" name="regaddress" placeholder="Customer Address" type="text">
                    <p><small class="text-danger pl-1" id="lblcusaddress"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegEmail">Customer Email</label>
                    <input class="form-control" id="txtRegEmail" name="regemail" placeholder="Customer Email" type="text">
                    <p><small class="text-danger pl-1" id="lblcusEmail"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegContact">Customer Contact</label>
                    <input class="form-control" id="txtRegContact" name="regcontact" placeholder="Customer Contact" type="text">
                    <p><small class="text-danger pl-1" id="lblcuscontact"></small></p>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="txtRegNIC">Customer NIC</label>
                    <input class="form-control" id="txtRegNIC" name="regNIC" placeholder="Customer NIC" type="text">
                    <p><small class="text-danger pl-1" id="lblcusNIC"></small></p>
                </div>



                <div class="modal-footer">
                    <button class="btn btn-danger" id="btnDeleteCustomer" type="Button">Delete</button>
                    <button class="btn btn-secondary" id="btnClearDeleteCustomerFormFields" type="reset">Clear</button>
                </div>
            </div>
            </form>
        </div>

    </section>

    <section class="row mt-4">
        <div class="col">
            <table class="table table-bordered table-hover mt-3">
                <thead class="bg-danger text-white">
                <tr class="table-success">
                    <th scope="col">Id</th>
                    <th scope="col">Customer Name</th>
                    <th scope="col">Address</th>
                    <th scope="col">Email</th>
                    <th scope="col">Contact</th>
                    <th scope="col">NIC</th>
                </tr>
                </thead>
                <tbody id="RegcusTable">


                </tbody>
            </table>
        </div>
    </section>
</section>

<script src="assets/BootStrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/JQuery/jquery-3.6.0.min.js"></script>
<script>

    const basecustomer = "http://localhost:8080/SpringMevenProject_war/RegCustomer"

      $("#btnSaveCustomer").click(function () {
            saveRegCustomer();
      });

      $("#btnGetAllCustomer").click(function () {

          loadAllCustomers();
      });

      $("#btnDeleteCustomer").click(function () {

          deleteCustomer();
      });

      $("#btnRegCustomerUpdate").click(function () {
           UpdateCustomer();
      });




     //Bind click events to the table rows
        function bindClickEvents() {
            $("#RegcusTable>tr").click(function () {
              // This is Get values to the selected row
                let regid = $(this).children().eq(0).text();
                let regname = $(this).children().eq(1).text();
                let regaddress = $(this).children().eq(2).text();
                let regemail = $(this).children().eq(3).text();
                let regcontact = $(this).children().eq(4).text();
                let regNIC = $(this).children().eq(5).text();

                //Set values to the text-fields
                $("#txtRegCusID").val(regid);
                $("#txtRegCusName").val(regname);
                $("#txtRegAddress").val(regaddress);
                $("#txtRegEmail").val(regemail);
                $("#txtRegContact").val(regcontact);
                $("#txtRegNIC").val(regNIC);

            });

        }



     //saveCustomer
    function saveRegCustomer() {
           var data =  $("#RegCustomerFrom").serialize(); // return query string of from with name: type - value
             $.ajax({
                 url:basecustomer,
                 method:"POST",
                 data:data,  //if we send the data with the request
                 success: function (res) {
                     if (res.code==200){
                         alert("Save Customer");
                     }
                 },
                 error:function (ob) {
                     alert(ob.responseJSON.message);

                 }
             });
       }
//-------------------------------------------------------------------------------------------------------------------------------------
    //load all RegCustomers
    function loadAllCustomers(){
        $("#RegcusTable").empty();
        $.ajax({
            url:basecustomer,
            method:"GET",

            success: function(resp) {
                for (const regcustomer of resp.data){
                   let row = `<tr><td>${regcustomer.regid}</td> <td>${regcustomer.regname}</td> <td>${regcustomer.regaddress}</td><td>${regcustomer.regemail}</td><td>${regcustomer.regcontact}</td><td>${regcustomer.regNIC}</td></tr>`;
                    $("#RegcusTable").append(row);

                }
                bindClickEvents();
                clearForm();
            },
            error :  function (ob) {
                alert(ob.responseJSON.message);

            }
        });
    }
//------------------------------------------------------------------------------------------------------------------------------------------
     // deletecustomer
    function deleteCustomer() {
        let regcustomerID = $("#txtSearchRegCusID").val();

         $.ajax({
             url: basecustomer + "?regid=" + regcustomerID,
             method:"DELETE",
             success: function (res) {
                  if (res.code == 200) {
                      alert("RegCustomer Successfully Deleted");
                      loadAllCustomers();
                      clearForm();
                  }

             },
              error:function (ob) {
                  alert(ob.responseJSON.message);

              }
         });
    }
//------------------------------------------------------------------------------------------------------------------------------------
      //Update Customer
     function  UpdateCustomer(){
       var cusDb = {
           regid : $("#txtRegCusID").val(),
           regname : $("#txtRegCusName").val(),
           regaddress : $("#txtRegAddress").val(),
           regemail : $("#txtRegEmail").val(),
           regcontact : $("#txtRegContact").val(),
           regNIC  : $("#txtRegNIC").val()
       }

       $.ajax({
           url:basecustomer,
           method : "PUT",
           contentType: "application/json",
           data : JSON.stringify(cusDb),
           success : function (res) {
            if (res.code == 200) {
                 alert("Successfully Updated");
                 loadAllCustomers();
                 clearForm();
            }
           },
           error : function (ob) {
                alert(ob.responseJSON.message);
           }

       });

     }
//---------------------------------------------------------------------------------------------------------------------------------
$("#btnRegCustomerSearch").click(function () {
    searchRegCustomer();
});

  function   searchRegCustomer() {
      var regcusid = $("#txtSearchRegCusID").val();
      $.ajax({
         url:basecustomer +"/"+ regcusid,
          method:"GET",
          success: function (res) {
             if (res.code==200){
                 var regcustomer = res.data;
                 $("#txtRegCusID").val(regcustomer.regid);
                 $("#txtRegCusName").val(regcustomer.regname);
                 $("#txtRegAddress").val(regcustomer.regaddress);
                 $("#txtRegEmail").val(regcustomer.regemail);
                 $("#txtRegContact").val(regcustomer.regcontact);
                 $("#txtRegNIC").val(regcustomer.regNIC);
             } else {
                 clearForm();
                 loadAllCustomers();
             }

          },
          error:function (ob) {
             alert(ob.responseJSON.message);

          }
      });
  }
//-------------------------------------------------------------------------------------------------------------------------------
    function clearForm(){
        $("#txtRegCusID").val("");
        $("#txtRegCusName").val("");
        $("#txtRegAddress").val("");
        $("#txtRegEmail").val("");
        $("#txtRegContact").val("");
        $("#txtRegNIC").val("");

    }

</script>
</body>
</html>